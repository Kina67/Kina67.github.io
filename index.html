<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <title>Criptazione/Decriptazione</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500&display=swap" rel="stylesheet">
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    body {
      font-family: 'Roboto', sans-serif;
      background-color: #121212;
      color: #e0e0e0;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      padding: 20px;
      font-size: 14px;
    }
    .container {
      background-color: #1e1e1e;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
      padding: 20px;
      width: 100%;
      max-width: 600px;
    }
    textarea {
      width: 100%;
      padding: 10px;
      margin-bottom: 10px;
      border: 1px solid #444;
      border-radius: 5px;
      background-color: #2c2c2c;
      color: #e0e0e0;
      resize: vertical;
      font-size: 14px;
    }
    input[type="password"] {
      width: 100%;
      padding: 8px;
      margin-bottom: 10px;
      border: 1px solid #444;
      border-radius: 5px;
      background-color: #2c2c2c;
      color: #e0e0e0;
      font-size: 14px;
    }
    .buttons {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }
    button {
      background-color: #80cbc4;
      color: #121212;
      border: none;
      border-radius: 5px;
      padding: 8px 12px;
      cursor: pointer;
      transition: background-color 0.3s ease, transform 0.2s ease;
      font-size: 14px;
      flex: 1;
    }
    button:hover {
      background-color: #72b7ad;
      transform: scale(1.02);
    }
  </style>
</head>
<body>
  <div class="container">
    <textarea id="textInput" rows="6" placeholder="Inserisci qui il testo..."></textarea>
    <input type="password" id="password" placeholder="Password">
    <div class="buttons">
      <button id="encryptBtn">Cripta</button>
      <button id="decryptBtn">Decripta</button>
    </div>
    <div class="buttons" style="margin-top: 10px;">
      <button id="copyBtn">Copia</button>
      <button id="pasteBtn">Incolla</button>
      <button id="clearBtn">Cancella</button>
    </div>
  </div>

  <script>
    const ENCRYPTED_PREFIX = "ENC:";
    const saltLength = 16;
    const ivLength = 12;
    const iterations = 100000;
    const keyLength = 256;

    document.getElementById('encryptBtn').addEventListener('click', async () => {
      const textArea = document.getElementById('textInput');
      const password = document.getElementById('password').value;
      if (!textArea.value || !password) {
        alert("Inserisci sia il testo che la password.");
        return;
      }
      if (textArea.value.startsWith(ENCRYPTED_PREFIX)) {
        alert("Il testo è già criptato. Non è possibile criptarlo ulteriormente.");
        return;
      }
      textArea.value = await encryptText(textArea.value, password);
    });

    document.getElementById('decryptBtn').addEventListener('click', async () => {
      const textArea = document.getElementById('textInput');
      const password = document.getElementById('password').value;
      if (!textArea.value || !password) {
        alert("Inserisci sia il testo che la password.");
        return;
      }
      if (!textArea.value.startsWith(ENCRYPTED_PREFIX)) {
        alert("Il testo non sembra essere criptato.");
        return;
      }
      textArea.value = await decryptText(textArea.value, password);
    });

    document.getElementById('copyBtn').addEventListener('click', async () => {
      const textArea = document.getElementById('textInput');
      await navigator.clipboard.writeText(textArea.value);
      alert("Testo copiato!");
    });

    document.getElementById('pasteBtn').addEventListener('click', async () => {
      const textArea = document.getElementById('textInput');
      const clipboardText = await navigator.clipboard.readText();
      textArea.value = clipboardText;
    });

    document.getElementById('clearBtn').addEventListener('click', () => {
      document.getElementById('textInput').value = "";
      document.getElementById('password').value = "";
    });
  </script>
</body>
</html>
